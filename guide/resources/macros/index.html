<!DOCTYPE html><html><head><title>Mazurka | Resources - Macros</title><meta name=description content="Hypermedia toolkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><meta property=og:title content="Resources - Macros"><meta property=og:site_name content=mazurka.io><meta property=og:url content=/guide/resources/macros><meta property=og:description content="Hypermedia toolkit"><meta property=og:type content=article><meta property=og:locale content=en_US><link rel=stylesheet href=/main.min.css><link rel=icon type=image/png href=/favicon.png><body><div class=Toolbar><div class=Toolbar-contents><a href="/" class=Toolbar-logo><div class=Toolbar-logo-image></div><div class=Toolbar-logo-text>Mazurka</div></a><div class=Toolbar-links><a href=/guide/introduction/overview class=Toolbar-link>Guide</a><a href="http://hexdocs.pm/mazurka/" class=Toolbar-link>Documentation</a><a href=https://github.com/mazurka/mazurka class=Toolbar-link>Repository</a><a href=https://github.com/mazurka/mazurka/blob/master/CHANGELOG.md class=Toolbar-link>Changelog</a></div></div></div><div class=Guide><div class=Guide-sidenav><ul class=Guide-sidenav-links><li class=Guide-sidenav-link><div class=Guide-sidenav-link-text><a href="/guide/introduction/overview/" class=Guide-sidenav-link-anchor>Introduction</a></div><ul class=Guide-sidenav-sublinks><li class=Guide-sidenav-sublink><a href="/guide/introduction/overview/" class=Guide-sidenav-sublink-anchor>Overview</a></li><li class=Guide-sidenav-sublink><a href="/guide/introduction/design/" class=Guide-sidenav-sublink-anchor>Design</a></li><li class=Guide-sidenav-sublink><a href="/guide/introduction/installation/" class=Guide-sidenav-sublink-anchor>Installation</a></li><li class=Guide-sidenav-sublink><a href="/guide/introduction/references/" class=Guide-sidenav-sublink-anchor>References</a></li></ul></li><li class=Guide-sidenav-link><div class=Guide-sidenav-link-text><a href="/guide/protocols/overview/" class=Guide-sidenav-link-anchor>Protocols</a></div><ul class=Guide-sidenav-sublinks><li class=Guide-sidenav-sublink><a href="/guide/protocols/overview/" class=Guide-sidenav-sublink-anchor>Overview</a></li><li class=Guide-sidenav-sublink><a href="/guide/protocols/references/" class=Guide-sidenav-sublink-anchor>References</a></li></ul></li><li class=Guide-sidenav-link><div class=Guide-sidenav-link-text><a href="/guide/resources/overview/" class="Guide-sidenav-link-anchor is-active">Resources</a></div><ul class=Guide-sidenav-sublinks><li class=Guide-sidenav-sublink><a href="/guide/resources/overview/" class=Guide-sidenav-sublink-anchor>Overview</a></li><li class=Guide-sidenav-sublink><a href="/guide/resources/macros/" class="Guide-sidenav-sublink-anchor is-active">Macros</a></li><li class=Guide-sidenav-sublink><a href="/guide/resources/mediatypes/" class=Guide-sidenav-sublink-anchor>Mediatypes</a></li><li class=Guide-sidenav-sublink><a href="/guide/resources/testing/" class=Guide-sidenav-sublink-anchor>Testing</a></li><li class=Guide-sidenav-sublink><a href="/guide/resources/references/" class=Guide-sidenav-sublink-anchor>References</a></li></ul></li><li class=Guide-sidenav-link><div class=Guide-sidenav-link-text><a href="/guide/dispatch/overview/" class=Guide-sidenav-link-anchor>Dispatch</a></div><ul class=Guide-sidenav-sublinks><li class=Guide-sidenav-sublink><a href="/guide/dispatch/overview/" class=Guide-sidenav-sublink-anchor>Overview</a></li><li class=Guide-sidenav-sublink><a href="/guide/dispatch/references/" class=Guide-sidenav-sublink-anchor>References</a></li></ul></li><li class=Guide-sidenav-link><div class=Guide-sidenav-link-text><a href="/guide/services/overview/" class=Guide-sidenav-link-anchor>Services</a></div><ul class=Guide-sidenav-sublinks><li class=Guide-sidenav-sublink><a href="/guide/services/overview/" class=Guide-sidenav-sublink-anchor>Overview</a></li><li class=Guide-sidenav-sublink><a href="/guide/services/references/" class=Guide-sidenav-sublink-anchor>References</a></li></ul></li></ul></div><div class=Guide-content><a target=__blank href=https://github.com/mazurka/mazurka.github.io/edit/source/src/modules/pages/guide/resources/macros/index.md class=Guide-content-edit>Edit this page</a><h1>Macros<a id=macros class=Header-anchor href=#macros aria-hidden=true><span class=Header-anchor-icon></span></a></h1><p>When declaring a Mazurka resource several macros are imported for resource construction and definition.</p><pre><code class="hljs elixir[initial]"><span id=code-initial-1><span class=hljs-class><span class=hljs-keyword>defmodule</span> <span class=hljs-title>MyAPI</span></span>.<span class=hljs-constant>Resource.Users.Read </span><span class=hljs-keyword>do</span></span>
<span id=code-initial-2>  <span class=hljs-keyword>use</span> <span class=hljs-constant>Mazurka.Resource</span></span>
<span id=code-initial-3><span class=hljs-keyword>end</span></span>
</code></pre><h2>Resource level<a id=resource-level class=Header-anchor href=#resource-level aria-hidden=true><span class=Header-anchor-icon></span></a></h2><h3>param<a id=param class=Header-anchor href=#param aria-hidden=true><span class=Header-anchor-icon></span></a></h3><pre><code class="hljs elixir[param&lt;-initial]"><span id=code-param-0 class=hljs-diff-line-unchanged><span class=hljs-class><span class=hljs-keyword>defmodule</span> <span class=hljs-title>MyAPI</span></span>.<span class=hljs-constant>Resource.Users.Read </span><span class=hljs-keyword>do</span>
</span><span id=code-param-1 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>use</span> <span class=hljs-constant>Mazurka.Resource</span>
</span>
<span id=code-param-2 class=hljs-diff-line-added>  param user
</span><span id=code-param-3 class=hljs-diff-line-unchanged><span class=hljs-keyword>end</span></span>
</code></pre><h3>let<a id=let class=Header-anchor href=#let aria-hidden=true><span class=Header-anchor-icon></span></a></h3><pre><code class="hljs elixir[let&lt;-param]"><span id=code-let-0 class=hljs-diff-line-unchanged><span class=hljs-class><span class=hljs-keyword>defmodule</span> <span class=hljs-title>MyAPI</span></span>.<span class=hljs-constant>Resource.Users.Read </span><span class=hljs-keyword>do</span>
</span><span id=code-let-1 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>use</span> <span class=hljs-constant>Mazurka.Resource</span>
</span>
<span id=code-let-2 class=hljs-diff-line-unchanged>  param user
</span>
<span id=code-let-3 class=hljs-diff-line-added>  let user_id = <span class=hljs-constant>Params.</span>get(<span class=hljs-string>"user"</span>)
</span><span id=code-let-4 class=hljs-diff-line-added>  let user = <span class=hljs-constant>Users.</span>read(user_id)
</span><span id=code-let-5 class=hljs-diff-line-unchanged><span class=hljs-keyword>end</span></span>
</code></pre><h3>condition<a id=condition class=Header-anchor href=#condition aria-hidden=true><span class=Header-anchor-icon></span></a></h3><pre><code class="hljs elixir[condition&lt;-let]"><span id=code-condition-0 class=hljs-diff-line-unchanged><span class=hljs-class><span class=hljs-keyword>defmodule</span> <span class=hljs-title>MyAPI</span></span>.<span class=hljs-constant>Resource.Users.Read </span><span class=hljs-keyword>do</span>
</span><span id=code-condition-1 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>use</span> <span class=hljs-constant>Mazurka.Resource</span>
</span>
<span id=code-condition-2 class=hljs-diff-line-unchanged>  param user
</span>
<span id=code-condition-3 class=hljs-diff-line-unchanged>  let user_id = <span class=hljs-constant>Params.</span>get(<span class=hljs-string>"user"</span>)
</span><span id=code-condition-4 class=hljs-diff-line-unchanged>  let user = <span class=hljs-constant>Users.</span>read(user_id)
</span>
<span id=code-condition-5 class=hljs-diff-line-added>  condition <span class=hljs-constant>Auth.</span>user_id == user_id, permission_error
</span><span id=code-condition-6 class=hljs-diff-line-unchanged><span class=hljs-keyword>end</span></span>
</code></pre><h3>mediatype<a id=mediatype class=Header-anchor href=#mediatype aria-hidden=true><span class=Header-anchor-icon></span></a></h3><pre><code class="hljs elixir[mediatype&lt;-condition]"><span id=code-mediatype-0 class=hljs-diff-line-unchanged><span class=hljs-class><span class=hljs-keyword>defmodule</span> <span class=hljs-title>MyAPI</span></span>.<span class=hljs-constant>Resource.Users.Read </span><span class=hljs-keyword>do</span>
</span><span id=code-mediatype-1 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>use</span> <span class=hljs-constant>Mazurka.Resource</span>
</span>
<span id=code-mediatype-2 class=hljs-diff-line-unchanged>  param user
</span>
<span id=code-mediatype-3 class=hljs-diff-line-unchanged>  let user_id = <span class=hljs-constant>Params.</span>get(<span class=hljs-string>"user"</span>)
</span><span id=code-mediatype-4 class=hljs-diff-line-unchanged>  let user = <span class=hljs-constant>Users.</span>read(user_id)
</span>
<span id=code-mediatype-5 class=hljs-diff-line-unchanged>  condition <span class=hljs-constant>Auth.</span>user_id == user_id, permission_error
</span>
<span id=code-mediatype-6 class=hljs-diff-line-added>  mediatype <span class=hljs-constant>Mazurka.Mediatype.Hyperjson </span><span class=hljs-keyword>do</span>
</span><span id=code-mediatype-7 class=hljs-diff-line-added>    <span class=hljs-comment># add mediatype actions here</span>
</span><span id=code-mediatype-8 class=hljs-diff-line-added>  <span class=hljs-keyword>end</span>
</span><span id=code-mediatype-9 class=hljs-diff-line-unchanged><span class=hljs-keyword>end</span></span>
</code></pre><h3>event<a id=event class=Header-anchor href=#event aria-hidden=true><span class=Header-anchor-icon></span></a></h3><pre><code class="hljs elixir[event&lt;-mediatype]"><span id=code-event-0 class=hljs-diff-line-unchanged><span class=hljs-class><span class=hljs-keyword>defmodule</span> <span class=hljs-title>MyAPI</span></span>.<span class=hljs-constant>Resource.Users.Read </span><span class=hljs-keyword>do</span>
</span><span id=code-event-1 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>use</span> <span class=hljs-constant>Mazurka.Resource</span>
</span>
<span id=code-event-2 class=hljs-diff-line-unchanged>  param user
</span>
<span id=code-event-3 class=hljs-diff-line-unchanged>  let user_id = <span class=hljs-constant>Params.</span>get(<span class=hljs-string>"user"</span>)
</span><span id=code-event-4 class=hljs-diff-line-unchanged>  let user = <span class=hljs-constant>Users.</span>read(user_id)
</span>
<span id=code-event-5 class=hljs-diff-line-unchanged>  condition <span class=hljs-constant>Auth.</span>user_id == user_id, permission_error
</span>
<span id=code-event-6 class=hljs-diff-line-unchanged>  mediatype <span class=hljs-constant>Mazurka.Mediatype.Hyperjson </span><span class=hljs-keyword>do</span>
</span><span id=code-event-7 class=hljs-diff-line-unchanged>    <span class=hljs-comment># add mediatype actions here</span>
</span><span id=code-event-8 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>end</span>
</span>
<span id=code-event-9 class=hljs-diff-line-added>  event <span class=hljs-keyword>do</span>
</span><span id=code-event-10 class=hljs-diff-line-added>    ^<span class=hljs-constant>IO.</span>puts(<span class=hljs-string>"User get <span class=hljs-subst>#{user_id}</span>"</span>)
</span><span id=code-event-11 class=hljs-diff-line-added>  <span class=hljs-keyword>end</span>
</span><span id=code-event-12 class=hljs-diff-line-unchanged><span class=hljs-keyword>end</span></span>
</code></pre><h3>test<a id=test class=Header-anchor href=#test aria-hidden=true><span class=Header-anchor-icon></span></a></h3><pre><code class="hljs elixir[test&lt;-event]"><span id=code-test-0 class=hljs-diff-line-unchanged><span class=hljs-class><span class=hljs-keyword>defmodule</span> <span class=hljs-title>MyAPI</span></span>.<span class=hljs-constant>Resource.Users.Read </span><span class=hljs-keyword>do</span>
</span><span id=code-test-1 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>use</span> <span class=hljs-constant>Mazurka.Resource</span>
</span>
<span id=code-test-2 class=hljs-diff-line-unchanged>  param user
</span>
<span id=code-test-3 class=hljs-diff-line-unchanged>  let user_id = <span class=hljs-constant>Params.</span>get(<span class=hljs-string>"user"</span>)
</span><span id=code-test-4 class=hljs-diff-line-unchanged>  let user = <span class=hljs-constant>Users.</span>read(user_id)
</span>
<span id=code-test-5 class=hljs-diff-line-unchanged>  condition <span class=hljs-constant>Auth.</span>user_id == user_id, permission_error
</span>
<span id=code-test-6 class=hljs-diff-line-unchanged>  mediatype <span class=hljs-constant>Mazurka.Mediatype.Hyperjson </span><span class=hljs-keyword>do</span>
</span><span id=code-test-7 class=hljs-diff-line-unchanged>    <span class=hljs-comment># add mediatype actions here</span>
</span><span id=code-test-8 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>end</span>
</span>
<span id=code-test-9 class=hljs-diff-line-unchanged>  event <span class=hljs-keyword>do</span>
</span><span id=code-test-10 class=hljs-diff-line-unchanged>    ^<span class=hljs-constant>IO.</span>puts(<span class=hljs-string>"User get <span class=hljs-subst>#{user_id}</span>"</span>)
</span><span id=code-test-11 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>end</span>
</span>
<span id=code-test-12 class=hljs-diff-line-added>  test <span class=hljs-string>"should respond with a user"</span> <span class=hljs-keyword>do</span>
</span><span id=code-test-13 class=hljs-diff-line-added>    conn = request <span class=hljs-keyword>do</span>
</span><span id=code-test-14 class=hljs-diff-line-added>      bearer <span class=hljs-number>123</span>
</span><span id=code-test-15 class=hljs-diff-line-added>    <span class=hljs-keyword>end</span>
</span>
<span id=code-test-16 class=hljs-diff-line-added>    assert conn.status == <span class=hljs-number>200</span>
</span><span id=code-test-17 class=hljs-diff-line-added>  <span class=hljs-keyword>end</span>
</span><span id=code-test-18 class=hljs-diff-line-unchanged><span class=hljs-keyword>end</span></span>
</code></pre><h2>Mediatype level<a id=mediatype-level class=Header-anchor href=#mediatype-level aria-hidden=true><span class=Header-anchor-icon></span></a></h2><h3>action<a id=action class=Header-anchor href=#action aria-hidden=true><span class=Header-anchor-icon></span></a></h3><pre><code class="hljs elixir[action&lt;-test]"><span id=code-action-0 class=hljs-diff-line-unchanged><span class=hljs-class><span class=hljs-keyword>defmodule</span> <span class=hljs-title>MyAPI</span></span>.<span class=hljs-constant>Resource.Users.Read </span><span class=hljs-keyword>do</span>
</span><span id=code-action-1 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>use</span> <span class=hljs-constant>Mazurka.Resource</span>
</span>
<span id=code-action-2 class=hljs-diff-line-unchanged>  param user
</span>
<span id=code-action-3 class=hljs-diff-line-unchanged>  let user_id = <span class=hljs-constant>Params.</span>get(<span class=hljs-string>"user"</span>)
</span><span id=code-action-4 class=hljs-diff-line-unchanged>  let user = <span class=hljs-constant>Users.</span>read(user_id)
</span>
<span id=code-action-5 class=hljs-diff-line-unchanged>  condition <span class=hljs-constant>Auth.</span>user_id == user_id, permission_error
</span>
<span id=code-action-6 class=hljs-diff-line-unchanged>  mediatype <span class=hljs-constant>Mazurka.Mediatype.Hyperjson </span><span class=hljs-keyword>do</span>
</span><span id=code-action-7 class=hljs-diff-line-removed>    <span class=hljs-comment># add mediatype actions here</span>
</span><span id=code-action-8 class=hljs-diff-line-added>    action <span class=hljs-keyword>do</span>
</span><span id=code-action-9 class=hljs-diff-line-added>      %{
</span><span id=code-action-10 class=hljs-diff-line-added>        <span class=hljs-string>"name"</span> =&gt; ^<span class=hljs-constant>Dict.</span>get(user, <span class=hljs-string>"name"</span>),
</span><span id=code-action-11 class=hljs-diff-line-added>        <span class=hljs-string>"avatar"</span> =&gt; %{
</span><span id=code-action-12 class=hljs-diff-line-added>          <span class=hljs-string>"src"</span> =&gt; ^<span class=hljs-constant>Dict.</span>get(user, <span class=hljs-string>"image"</span>)
</span><span id=code-action-13 class=hljs-diff-line-added>        }
</span><span id=code-action-14 class=hljs-diff-line-added>      }
</span><span id=code-action-15 class=hljs-diff-line-added>    <span class=hljs-keyword>end</span>
</span><span id=code-action-16 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>end</span>
</span>
<span id=code-action-17 class=hljs-diff-line-unchanged>  event <span class=hljs-keyword>do</span>
</span><span id=code-action-18 class=hljs-diff-line-unchanged>    ^<span class=hljs-constant>IO.</span>puts(<span class=hljs-string>"User get <span class=hljs-subst>#{user_id}</span>"</span>)
</span><span id=code-action-19 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>end</span>
</span>
<span id=code-action-20 class=hljs-diff-line-unchanged>  test <span class=hljs-string>"should respond with a user"</span> <span class=hljs-keyword>do</span>
</span><span id=code-action-21 class=hljs-diff-line-unchanged>    conn = request <span class=hljs-keyword>do</span>
</span><span id=code-action-22 class=hljs-diff-line-unchanged>      bearer <span class=hljs-number>123</span>
</span><span id=code-action-23 class=hljs-diff-line-unchanged>    <span class=hljs-keyword>end</span>
</span>
<span id=code-action-24 class=hljs-diff-line-unchanged>    assert conn.status == <span class=hljs-number>200</span>
</span><span id=code-action-25 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>end</span>
</span><span id=code-action-26 class=hljs-diff-line-unchanged><span class=hljs-keyword>end</span></span>
</code></pre><h3>affordance<a id=affordance class=Header-anchor href=#affordance aria-hidden=true><span class=Header-anchor-icon></span></a></h3><pre><code class="hljs elixir[affordance&lt;-action]"><span id=code-affordance-0 class=hljs-diff-line-unchanged><span class=hljs-class><span class=hljs-keyword>defmodule</span> <span class=hljs-title>MyAPI</span></span>.<span class=hljs-constant>Resource.Users.Read </span><span class=hljs-keyword>do</span>
</span><span id=code-affordance-1 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>use</span> <span class=hljs-constant>Mazurka.Resource</span>
</span>
<span id=code-affordance-2 class=hljs-diff-line-unchanged>  param user
</span>
<span id=code-affordance-3 class=hljs-diff-line-unchanged>  let user_id = <span class=hljs-constant>Params.</span>get(<span class=hljs-string>"user"</span>)
</span><span id=code-affordance-4 class=hljs-diff-line-unchanged>  let user = <span class=hljs-constant>Users.</span>read(user_id)
</span>
<span id=code-affordance-5 class=hljs-diff-line-unchanged>  condition <span class=hljs-constant>Auth.</span>user_id == user_id, permission_error
</span>
<span id=code-affordance-6 class=hljs-diff-line-unchanged>  mediatype <span class=hljs-constant>Mazurka.Mediatype.Hyperjson </span><span class=hljs-keyword>do</span>
</span><span id=code-affordance-7 class=hljs-diff-line-unchanged>    action <span class=hljs-keyword>do</span>
</span><span id=code-affordance-8 class=hljs-diff-line-unchanged>      %{
</span><span id=code-affordance-9 class=hljs-diff-line-unchanged>        <span class=hljs-string>"name"</span> =&gt; ^<span class=hljs-constant>Dict.</span>get(user, <span class=hljs-string>"name"</span>),
</span><span id=code-affordance-10 class=hljs-diff-line-unchanged>        <span class=hljs-string>"avatar"</span> =&gt; %{
</span><span id=code-affordance-11 class=hljs-diff-line-unchanged>          <span class=hljs-string>"src"</span> =&gt; ^<span class=hljs-constant>Dict.</span>get(user, <span class=hljs-string>"image"</span>)
</span><span id=code-affordance-12 class=hljs-diff-line-unchanged>        }
</span><span id=code-affordance-13 class=hljs-diff-line-unchanged>      }
</span><span id=code-affordance-14 class=hljs-diff-line-unchanged>    <span class=hljs-keyword>end</span>
</span>
<span id=code-affordance-15 class=hljs-diff-line-added>    affordance <span class=hljs-keyword>do</span>
</span><span id=code-affordance-16 class=hljs-diff-line-added>      %{
</span><span id=code-affordance-17 class=hljs-diff-line-added>        <span class=hljs-string>"name"</span> =&gt; ^<span class=hljs-constant>Dict.</span>get(user, <span class=hljs-string>"name"</span>)
</span><span id=code-affordance-18 class=hljs-diff-line-added>      }
</span><span id=code-affordance-19 class=hljs-diff-line-added>    <span class=hljs-keyword>end</span>
</span><span id=code-affordance-20 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>end</span>
</span>
<span id=code-affordance-21 class=hljs-diff-line-unchanged>  event <span class=hljs-keyword>do</span>
</span><span id=code-affordance-22 class=hljs-diff-line-unchanged>    ^<span class=hljs-constant>IO.</span>puts(<span class=hljs-string>"User get <span class=hljs-subst>#{user_id}</span>"</span>)
</span><span id=code-affordance-23 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>end</span>
</span>
<span id=code-affordance-24 class=hljs-diff-line-unchanged>  test <span class=hljs-string>"should respond with a user"</span> <span class=hljs-keyword>do</span>
</span><span id=code-affordance-25 class=hljs-diff-line-unchanged>    conn = request <span class=hljs-keyword>do</span>
</span><span id=code-affordance-26 class=hljs-diff-line-unchanged>      bearer <span class=hljs-number>123</span>
</span><span id=code-affordance-27 class=hljs-diff-line-unchanged>    <span class=hljs-keyword>end</span>
</span>
<span id=code-affordance-28 class=hljs-diff-line-unchanged>    assert conn.status == <span class=hljs-number>200</span>
</span><span id=code-affordance-29 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>end</span>
</span><span id=code-affordance-30 class=hljs-diff-line-unchanged><span class=hljs-keyword>end</span></span>
</code></pre><h3>error<a id=error class=Header-anchor href=#error aria-hidden=true><span class=Header-anchor-icon></span></a></h3><pre><code class="hljs elixir[error&lt;-affordance]"><span id=code-error-0 class=hljs-diff-line-unchanged><span class=hljs-class><span class=hljs-keyword>defmodule</span> <span class=hljs-title>MyAPI</span></span>.<span class=hljs-constant>Resource.Users.Read </span><span class=hljs-keyword>do</span>
</span><span id=code-error-1 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>use</span> <span class=hljs-constant>Mazurka.Resource</span>
</span>
<span id=code-error-2 class=hljs-diff-line-unchanged>  param user
</span>
<span id=code-error-3 class=hljs-diff-line-unchanged>  let user_id = <span class=hljs-constant>Params.</span>get(<span class=hljs-string>"user"</span>)
</span><span id=code-error-4 class=hljs-diff-line-unchanged>  let user = <span class=hljs-constant>Users.</span>read(user_id)
</span>
<span id=code-error-5 class=hljs-diff-line-unchanged>  condition <span class=hljs-constant>Auth.</span>user_id == user_id, permission_error
</span>
<span id=code-error-6 class=hljs-diff-line-unchanged>  mediatype <span class=hljs-constant>Mazurka.Mediatype.Hyperjson </span><span class=hljs-keyword>do</span>
</span><span id=code-error-7 class=hljs-diff-line-unchanged>    action <span class=hljs-keyword>do</span>
</span><span id=code-error-8 class=hljs-diff-line-unchanged>      %{
</span><span id=code-error-9 class=hljs-diff-line-unchanged>        <span class=hljs-string>"name"</span> =&gt; ^<span class=hljs-constant>Dict.</span>get(user, <span class=hljs-string>"name"</span>),
</span><span id=code-error-10 class=hljs-diff-line-unchanged>        <span class=hljs-string>"avatar"</span> =&gt; %{
</span><span id=code-error-11 class=hljs-diff-line-unchanged>          <span class=hljs-string>"src"</span> =&gt; ^<span class=hljs-constant>Dict.</span>get(user, <span class=hljs-string>"image"</span>)
</span><span id=code-error-12 class=hljs-diff-line-unchanged>        }
</span><span id=code-error-13 class=hljs-diff-line-unchanged>      }
</span><span id=code-error-14 class=hljs-diff-line-unchanged>    <span class=hljs-keyword>end</span>
</span>
<span id=code-error-15 class=hljs-diff-line-unchanged>    affordance <span class=hljs-keyword>do</span>
</span><span id=code-error-16 class=hljs-diff-line-unchanged>      %{
</span><span id=code-error-17 class=hljs-diff-line-unchanged>        <span class=hljs-string>"name"</span> =&gt; ^<span class=hljs-constant>Dict.</span>get(user, <span class=hljs-string>"name"</span>)
</span><span id=code-error-18 class=hljs-diff-line-unchanged>      }
</span><span id=code-error-19 class=hljs-diff-line-unchanged>    <span class=hljs-keyword>end</span>
</span>
<span id=code-error-20 class=hljs-diff-line-added>    error <span class=hljs-keyword>do</span>
</span><span id=code-error-21 class=hljs-diff-line-added>      %{
</span><span id=code-error-22 class=hljs-diff-line-added>        <span class=hljs-string>"error"</span> =&gt; %{
</span><span id=code-error-23 class=hljs-diff-line-added>          <span class=hljs-string>"message"</span> =&gt; <span class=hljs-string>"Oops, looks like you can't see this user!"</span>
</span><span id=code-error-24 class=hljs-diff-line-added>        }
</span><span id=code-error-25 class=hljs-diff-line-added>      }
</span><span id=code-error-26 class=hljs-diff-line-added>    <span class=hljs-keyword>end</span>
</span><span id=code-error-27 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>end</span>
</span>
<span id=code-error-28 class=hljs-diff-line-unchanged>  event <span class=hljs-keyword>do</span>
</span><span id=code-error-29 class=hljs-diff-line-unchanged>    ^<span class=hljs-constant>IO.</span>puts(<span class=hljs-string>"User get <span class=hljs-subst>#{user_id}</span>"</span>)
</span><span id=code-error-30 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>end</span>
</span>
<span id=code-error-31 class=hljs-diff-line-unchanged>  test <span class=hljs-string>"should respond with a user"</span> <span class=hljs-keyword>do</span>
</span><span id=code-error-32 class=hljs-diff-line-unchanged>    conn = request <span class=hljs-keyword>do</span>
</span><span id=code-error-33 class=hljs-diff-line-unchanged>      bearer <span class=hljs-number>123</span>
</span><span id=code-error-34 class=hljs-diff-line-unchanged>    <span class=hljs-keyword>end</span>
</span>
<span id=code-error-35 class=hljs-diff-line-unchanged>    assert conn.status == <span class=hljs-number>200</span>
</span><span id=code-error-36 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>end</span>
</span><span id=code-error-37 class=hljs-diff-line-unchanged><span class=hljs-keyword>end</span></span>
</code></pre><h3>link_to<a id=link_to class=Header-anchor href=#link_to aria-hidden=true><span class=Header-anchor-icon></span></a></h3><pre><code class="hljs elixir[link_to&lt;-error]"><span id=code-link_to-0 class=hljs-diff-line-unchanged><span class=hljs-class><span class=hljs-keyword>defmodule</span> <span class=hljs-title>MyAPI</span></span>.<span class=hljs-constant>Resource.Users.Read </span><span class=hljs-keyword>do</span>
</span><span id=code-link_to-1 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>use</span> <span class=hljs-constant>Mazurka.Resource</span>
</span>
<span id=code-link_to-2 class=hljs-diff-line-unchanged>  param user
</span>
<span id=code-link_to-3 class=hljs-diff-line-unchanged>  let user_id = <span class=hljs-constant>Params.</span>get(<span class=hljs-string>"user"</span>)
</span><span id=code-link_to-4 class=hljs-diff-line-unchanged>  let user = <span class=hljs-constant>Users.</span>read(user_id)
</span>
<span id=code-link_to-5 class=hljs-diff-line-unchanged>  condition <span class=hljs-constant>Auth.</span>user_id == user_id, permission_error
</span>
<span id=code-link_to-6 class=hljs-diff-line-unchanged>  mediatype <span class=hljs-constant>Mazurka.Mediatype.Hyperjson </span><span class=hljs-keyword>do</span>
</span><span id=code-link_to-7 class=hljs-diff-line-unchanged>    action <span class=hljs-keyword>do</span>
</span><span id=code-link_to-8 class=hljs-diff-line-unchanged>      %{
</span><span id=code-link_to-9 class=hljs-diff-line-unchanged>        <span class=hljs-string>"name"</span> =&gt; ^<span class=hljs-constant>Dict.</span>get(user, <span class=hljs-string>"name"</span>),
</span><span id=code-link_to-10 class=hljs-diff-line-unchanged>        <span class=hljs-string>"avatar"</span> =&gt; %{
</span><span id=code-link_to-11 class=hljs-diff-line-unchanged>          <span class=hljs-string>"src"</span> =&gt; ^<span class=hljs-constant>Dict.</span>get(user, <span class=hljs-string>"image"</span>)
</span><span id=code-link_to-12 class=hljs-diff-line-unchanged>        }
</span><span id=code-link_to-13 class=hljs-diff-line-unchanged>      }
</span><span id=code-link_to-14 class=hljs-diff-line-unchanged>    <span class=hljs-keyword>end</span>
</span>
<span id=code-link_to-15 class=hljs-diff-line-unchanged>    affordance <span class=hljs-keyword>do</span>
</span><span id=code-link_to-16 class=hljs-diff-line-unchanged>      %{
</span><span id=code-link_to-17 class=hljs-diff-line-unchanged>        <span class=hljs-string>"name"</span> =&gt; ^<span class=hljs-constant>Dict.</span>get(user, <span class=hljs-string>"name"</span>)
</span><span id=code-link_to-18 class=hljs-diff-line-unchanged>      }
</span><span id=code-link_to-19 class=hljs-diff-line-unchanged>    <span class=hljs-keyword>end</span>
</span>
<span id=code-link_to-20 class=hljs-diff-line-unchanged>    error <span class=hljs-keyword>do</span>
</span><span id=code-link_to-21 class=hljs-diff-line-unchanged>      %{
</span><span id=code-link_to-22 class=hljs-diff-line-unchanged>        <span class=hljs-string>"error"</span> =&gt; %{
</span><span id=code-link_to-23 class=hljs-diff-line-unchanged>          <span class=hljs-string>"message"</span> =&gt; <span class=hljs-string>"Oops, looks like you can't see this user!"</span>
</span><span id=code-link_to-24 class=hljs-diff-line-unchanged>        }
</span><span id=code-link_to-25 class=hljs-diff-line-unchanged>      }
</span><span id=code-link_to-26 class=hljs-diff-line-unchanged>    <span class=hljs-keyword>end</span>
</span><span id=code-link_to-27 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>end</span>
</span>
<span id=code-link_to-28 class=hljs-diff-line-unchanged>  event <span class=hljs-keyword>do</span>
</span><span id=code-link_to-29 class=hljs-diff-line-unchanged>    ^<span class=hljs-constant>IO.</span>puts(<span class=hljs-string>"User get <span class=hljs-subst>#{user_id}</span>"</span>)
</span><span id=code-link_to-30 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>end</span>
</span>
<span id=code-link_to-31 class=hljs-diff-line-unchanged>  test <span class=hljs-string>"should respond with a user"</span> <span class=hljs-keyword>do</span>
</span><span id=code-link_to-32 class=hljs-diff-line-unchanged>    conn = request <span class=hljs-keyword>do</span>
</span><span id=code-link_to-33 class=hljs-diff-line-unchanged>      bearer <span class=hljs-number>123</span>
</span><span id=code-link_to-34 class=hljs-diff-line-unchanged>    <span class=hljs-keyword>end</span>
</span>
<span id=code-link_to-35 class=hljs-diff-line-unchanged>    assert conn.status == <span class=hljs-number>200</span>
</span><span id=code-link_to-36 class=hljs-diff-line-unchanged>  <span class=hljs-keyword>end</span>
</span><span id=code-link_to-37 class=hljs-diff-line-unchanged><span class=hljs-keyword>end</span></span>
</code></pre><h3>transition_to<a id=transition_to class=Header-anchor href=#transition_to aria-hidden=true><span class=Header-anchor-icon></span></a></h3></div></div><footer></footer><script src=/main.min.js></script>